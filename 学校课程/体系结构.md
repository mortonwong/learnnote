# 课程考试
## 分值比例
选择题20道 20%   
填空题10个空 20%
简答题2道 10%   
大题 50%    
大题不出作业题之外
## 章节重点
### 第一章

# 计算机系统结构


## 指标
MIPS=IPC * Hz * 10^6 用来衡量计算机的速度   
提高处理器运算速度:提高IPC(依靠先进的系统结构),提高HZ(1.缩短门电路延迟,依靠技术进步,2.流水线技术等,依靠系统结构)     
MILOPS≈3MIPS 反映浮点运算的能力,不能反映整体性能    


## 多级层次结构
L1和L2都是硬件级，其它都是软件级
- L0：电子线路
- L1：微程序机器级。直接由硬件执行的
- L2：机器语言（传统机器级）。程序员的程序在L1解释执行。有的硬件没有微程序，则没有L1，由机器直接执行机器语言
- L3：操作系统虚拟机（作业控制语言）称为**系统调用**和**系统参数**
- L4：汇编语言虚拟机
- L5：高级语言虚拟机
- L6：应用程序虚拟机

汇编和机器语言之间，还有一层操作系统级  
汇编语言 翻译 成机器语言，之后都是解释  
机器语言级到微程序级的翻译，也叫**仿真**    



### 解释和翻译的区别
L4开始，都是L+1级翻译成L级程序。由程序整体转换成L级后再执行L+1级程序，解释程序则是一条一条转换，内存占用更低，但是更耗时。

## 定义
系统结构广义定义：**指令集结构+组成+硬件**    
对通用寄存器机器来说，系统结构是：  
(1)指令系统 
(2)数据表示  
(3)寻址规则  
(4)寄存器定义  
(5)中断系统  
(6)机器工作状态的定义和切换  
(7)存储系统  
(8)信息保护  
(9) I/O结构  

## 计算机组织和计算机实现
**区分：实现会涉及硬件的型号，不同的组成有不同的汇编程序**
### 计算机组成
计算机系统的逻辑实现    
例如逻辑电路图  
包括数据流、控制流的组成    
    
对组成不透明的：程序员的硬件细节、控制信号、接口技术、存储器技术
### 计算机实现
计算机系统的物理实现    
根据电路图的具体硬件实现    
对组成、系统结构是透明的
### 系列机
有相同的体系结构，不同的组织和实现的机器    
程序员用的指令集是相同的。
### 兼容机
不同厂家的有相同体系结构的机器，称为兼容机。系列机是一个厂商的机器。
### 系列机的软件兼容
向上下兼容：软件兼容高档和低档的机器
向前后兼容：软件兼容，兼容未来的和以前的机器
### 体系结构的发展，和系列机的矛盾
后续机器的体系结构，只是在原有的扩充，此时软件的向前兼容和向下兼容可以不做要求。**向后兼容是软件兼容的根本特征**
## 模拟与仿真
用于非系列机的软件移植
### 模拟
用**机器语言程序**，解释另一个机器（虚拟机）的**指令系统**  
因为另一台机器的硬件无法在这台机器获得，只能将另一台机器的指令系统，即软硬交界，用宿主机器的机器语言来完成**解释**
### 仿真
用**微程序**直接解释另一机器的**指令系统**
### 使用场景
频繁使用指令，用仿真    
难以仿真，用模拟    
## 分类
### Flynn分类法
依据**指令流和数据流的多倍性**  
- 指令流：机器执行的指令序列
- 数据流：指令流调用的数据序列
- 多倍性：同一阶段执行的指令或数据的最大数目

Flynn分类法把计算机系统的结构  
分为4类:  
#### 单指令流单数据流(SISD)  
传统单处理机    
#### 单指令流多数据流(SIMD)   
阵列处理机，并行处理机
#### 多指令流单数据流(MISD)  
目前没有实现，搏动阵列机  
#### 多指令流多数据流(MIMD)  
最通用常见
#### 耦合度
最松耦合：处理机之间无物理连接  
松耦合：处理机之间低速通信线路连接  
紧密耦合：处理机之间 高速总线or开关相连
#### flynn缺点
对**标量及向量流水处理机**，不明确，因为只有一个PU，缺有多个数据流
### 冯氏分类法
#### 最大并行度
单位时间能处理的最大二进制位数  
#### n
一个功能部件能同时处理的字数 
#### m
一个字能同时处理的位数   
#### 四种
(1) 字串位串， WSBS n=1,m=1  每个字每一位都串行 
(2) 字串位并， WSBP n=1,m>1  每个字多个位并行   
(3) 字并位串， WPBS n>1,m=1  多个字每一位并行   
(4) 字并位并， WPBP n>1,m>1  多字多位全部并行   
## 计算机系统设计技术

### 系统设计的主要任务
1. 确定用户需求的功能、价格、性能
2. 软硬件取舍的原则
3. 符合未来发展方向
### 软硬件取舍的原则
1. 对下：组成和实现
2. 对手：编译和操作系统的实现
3. 性价比
### 计算机成本
D：design，开发成本 
M：make，生产成本   
计算机成本=软件成本+硬件成本    
软件成本=开发成本=Ds    
硬件成本=开发成本+生产成本=Dh+Mh    
    
基本单元功能适宜用硬件实现  
产量大的适宜用硬件实现  
### 系统设计的主要方法
#### 由下往上
直接设计微程序级和传统机器级    
缺点：硬件不可更改，软件被动
#### 自上而下
从应用级开始往下设计    
优点：适用于专用机  
缺点：开发周期长
#### 由中间开始
最科学的方法    
确定软、硬界面  
需要完善的硬件模拟环境、软件设计环境
### 设计步骤
1. 需求分析
2. 需求规格说明（功能、性能、设计准则）
3. 概要性设计（机器级界面）
4. 详细设计
5. 优化和评价
## 设计中的定量原理
原理：加快经常性事件的速度  
Amdahl定律：系统性能加速比 与 部件执行时间/系统总执行时间 相关
### AMdahl定律
要背：  
1. **Sn=1/（1-Fe可改进比例+Fe可改进比例/Se部件加速比）**   
2. **CPU时间=CPI * IC * t**    
3. **非RISC系统，平均CPI=（CPIi * Ii的1~n求和）/IC**   
4. **RISC的平均CPI用加权平均方法计算**
## 系统结构的评价标准
CPU时间=系统CPU时间+用户CPU时间（性能）     
衡量标准：真正程序运行的时间        
不可靠：MIPS、MFLOPS
### 测试程序
- 实际的应用程序
- 核心程序
- 玩具基准测试程序
- 综合测试程序（基于核心程序）
## 并行性
### 同时性
两个以上事件同一时间发生
### 并发性
两个以上事件同一时间间隔内发生（如时间片轮转）
### 并行等级
从低到高：  
- 微操作/微指令之间
- 指令之间
- 进程之间
- 程序之间
### 并行途径
#### 时间重叠
一套硬件轮流服务，例如流水技术
#### 资源重复
设置多个硬件，例如并行处理机
#### 资源共享
用软件方法让多个用户轮流公用一套硬件资源。如网络的单服务器和多客户端之间    
### 3T指标
- 1TFLOPS的计算能力      
- 1T的主存容量       
- 1TB/s的IO贷款

## 透明性
**透明就是看不到的**    
系统程序员：写操作系统、写编译软件的    
### 对系统和应用程序员都透明
数据通路宽度、Cache存储器、指令缓冲寄存器
### 对应用程序员透明，对系统程序员不透明
虚拟存储器、程序状态字、启动IO指令
### 都不透明
执行指令

# 第二章
## 数据表示
硬件能直接识别和引用的数据类型  
### 和数据结构、数据类型的关系
数据类型的子集：数据结构、数据表示  
### 系统结构设计的着重点
哪些由数据结构实现，哪些由数据表示实现
### 常用数据表示
#### 基本型
定点数据、浮点数据、逻辑数、二进制、十进制
#### 高级型
向量、可变长字符串
#### MIPS的数据表示
- 整数：字节8位、半字16位、字32位、双字64位
- 浮点数：单精度32位、双精度64位
### 发展
数据表示逐步上移，越来越多的数据结构被数据表示替代
### 高级数据表示
#### 自定义数据表示
##### 数据类型标志符
使操作码无属性，对高级程序员透明    
缺点：

1. 占用位数，使程序更大。解决指令和数据字长不等：1.分开存放。2.多个指令字放在一个存储字。3.扩展指令功能，1条=多条
2. 降低单条指令执行速度，多一个标志符判断。但程序时间总体减少（因为编制时间、调试时间减少）
3. 和其它计算机兼容性差，因为标志位的不同

##### 数据描述符
- 用于多维数据（记录、阵列），数据都是同属性，可以不用每个都有标志符，而用描述符一个就行。  
- 描述符类似一个“表头”，有数据的地址信息等，和数据分开存储    
- 阵列描述符：树形（指针链接）    
- 向量描述符：比变址法更快，更简化编译，机器结构更简单

####  向量数组数据表示
- 用描述符
- 向量就是数组    
- 标量计算机：无向量的设计，每个元素都要单独计算地址    
- 向量计算机：有向量数据表示、向量指令    
#### 堆栈数据表示
用计算机硬件结构实现接口课中所学的堆栈。可以实现堆等数据类型
#### 浮点数据表示
- M:尾数，是纯小数，用原码or补码表示 .1xx
- E:阶玛,用原码、补码表示，常用移码表示
- rn：尾基，有2、8、10等
- 设计者决定p（阶玛的位数，不包括符号位）、m（尾数的位数）、rm的大小
##### 讨论rm的选定
- 简化讨论：非负阶、正尾数、规格化（尾数最高位为1）
- 阶玛最小值：0
- 阶玛最大值：rm^p-1
- 尾数最小值：1/rm，即0.1（B）
- 尾数最大值：1-(rm^-m)
- 范围=上述四个的两个相乘,得最小值和最大值
- 浮点数可表示数的个数
##### 下溢处理方法
- 下溢就是最末位多了数字
- 截断法 11:11 => 11: (误差大)
- 舍入法 01:1 => 10: (溢出的最高位+1)(开销大)
- 恒置1法 10:1 => 11: (字长最低位永远是1) (最大误差大,多用在中大型机器)
- 查表舍入法 把k-1+舍弃位 放入k位rom,若全1使用截断法,否则用舍入法 (较好,缺点是硬件量大)
- 透明性分析：下溢处理属于计算机组成的任务，对系统结构透明，对应用和系统程序员透明

## 寻址技术
系统结构着重选择和确定寻址技术
### 编址方式
对存储设备进行编址的方法
- 主存储器
- 通用寄存器
- 其它寄存器
- 输入输出设备
#### 编址单位
处理机字长、主存储器字长的理解  
- 按字编址
- 按字节编址（最普遍）
- 按位编址（支持可变长数据）
##### 按字节编址在存储器的方式
1. 任意位置，连续存储（优点：无浪费。缺点：速度低，读写控制复杂）
2. 从存储字的起始位置存储（优点：读写控制简单。缺点：利用率低）
3. 按整数边界存贮，数据段不会跨存储字存入（优点：一个存储周期可以访问。缺点：依然有浪费）
#### 零地址空间个数
- 一个零地址（优点：简化指令系统。缺点：地址形成复杂）
- 两个零地址（主存和输入输出。优点：地址短，执行快，缺点：指令系统复杂）
- 三个零地址（主存、输入输出设备、通用寄存器）**最常用**
- 无零地址空间（堆栈计算机，有关设备都不需编址，隐式寻址。缺点：指令设计不规范）
#### 三零地址空间系统的寻址技术
- 寄存器寻址（直接寻址，按字编址，地址码短）
- 主存寻址（直接寻址or间接寻址or变址寻址，各种编址方式，地址码长）
- 输入输出寻址 （直接寻址，非线性编址，地址码长短不一）
#### 输入输出的非线性编址
- 一台设备一个地址（优点：地址规整。缺点：对接口寄存器设置指令，指令系统复杂）
- 一台设备两个地址（**最常用**，优点：指令系统简单。问题：可能有寄存器没分配地址
- 一台设备多个地址（多用于和主存、寄存器公用一个零地址空间的计算机系统

### 寻址方式
- 面向主存
- 面向寄存器
- 面向堆栈
#### 指令中寻址方式的表示
1. （占用指令位）用指令的最高两位表示长度和格式
2. （占用地址位）寻址方式位法，在地址码中有位表示寻址方式
### 定位方式
定位：逻辑地址——变换——物理地址
#### 直接定位
逻辑地址=物理地址
#### 静态（再）定位
用软件方法，把指令的逻辑地址改成物理地址    
缺点：主存利用率不搞，用户不能共享
#### 动态定位
由硬件方法，完成基址寻址，不改变指令    
变址寻址：对数组地址计算    
基址寻址：逻辑地址 变换为 物理地址
### 指令系统的设计和改进
#### 指令系统的设计
- 功能设计（运算类、控制类、数据传送类）
- 格式设计（地址码、操作码）
#### 格式优化
##### 包括
- 操作码：1.种类。2.数据类型（自定义数据表示则不需要）
- 地址码：1.地址。2.附加信息（偏移量、长度、变址寄存器指令等）。3.寻址方式
##### 优化目标
最短的位数 
哈夫曼压缩思想：最高的事件用最小的位数表示，总体平均时间缩短

##### 操作码优化
操作码的编码方法：
1. 定长二进制编码
2. 哈夫曼编码
3. 扩展编码法
评价标准:**熵**(平均信息量) 
信息量:-logpi (pi是事件的概率,log的底数是2) 
熵 H=平均信息量
###### 定长二进制编码
- 编码的玛长:log p(底数2)。p是数据个数。 （好算，不用记）
- 信息冗余量K：1-H/平均玛长
- 优点：定字长。缺点：操作码长度增加严重
###### 哈夫曼编码
编码方式：
1. 指令按频率排序，升序
2. 最小（最左）频率的两个合并，重新排序
3. 重复2，直到只剩两个频率，分别指定为0和1
4. 画树，规定左1右0。

- 平均码长：求和（pi * 位数） 
- 信息冗余量K=1-H/平均码长 
- 优点：平均长度短，信息冗余小。缺点：操作码不规整，不便于译码，所以不实用
###### （哈夫曼概念的）扩展操作码编码
特点：
1. 短码不是长码前缀（而是排序后标号+1递增）
2. 码长类型有限（大于等于两种）（比如只有2位和4位，不存在1位和3位）
3. 优点：利用率高，位数比哈夫曼更少
分类：（位数和长度不同）
1. 4-8-12等长扩展码
- 15/15/15编码法（0000；**1111** 0000；1111 1111 0000）
- 8/64/512编码法（0000；**1000** 0000；1000 1000 0000）
2. 4-6-10不等长扩展码
##### 地址码优化一：不同寻址方式，缩短地址码
###### 间接寻址
如在主存开辟区域存放地址，如1KB，存储字4B。
1024/4=512=2^8。则地址码只需8位+寻址方式位=十几位
###### 基址寻址
计算机有多个基址寄存器，存放着物理地址。 
地址码=基地寄存器号+偏移量
###### 基址+变址寻址
地址码+基址寄存器号+变址寄存器号+偏移量 
给出变址寄存器，便于增加寻找相邻地址数据的速度
###### 相对寻址
地址码中只标出相对位移量（位数很少）
以PC中的地址作为基地址。

###### 主存分段访问（多用于转移指令）
段号+段内地址
- 段内转移，地址码：段内地址
- 段间转移，地址码：段号
###### 访寄存器
只需寄存器号，更短的地址
##### 地址码优化二：多种地址码形式和长度
- R-R型
- R-S型 （S是访存地址,R是寄存器号）
- 立即操作数型
##### 地址码优化三：多操作数类型
- 单地址指令
- 多地址指令

##### 更彻底优化方法：采用多种指令字长度（CISC）
举例：IBM370的指令格式，2种操作码长度：8位，16位